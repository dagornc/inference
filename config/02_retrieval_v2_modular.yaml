# =============================================================================
# √âTAPE 02 v2 : RETRIEVAL AVANC√â - CONFIGURATION MODULAIRE
# =============================================================================
# Configuration avec activation/d√©sactivation individuelle de chaque sous-√©tape.
#
# NOUVEAUT√â v2.1 :
# - Section MASTER CONFIG : activer/d√©sactiver chaque √©tape facilement
# - PRESETS : configurations pr√©d√©finies (minimal, balanced, maximal, legacy_v1)
# - Matrice de d√©pendances : validation automatique
# - Mode debug : logging d√©taill√© de chaque √©tape
# =============================================================================

# =============================================================================
# ‚öôÔ∏è MASTER CONFIGURATION - ACTIVATION/D√âSACTIVATION DES SOUS-√âTAPES
# =============================================================================
# Activer/d√©sactiver individuellement chaque sous-√©tape de la Phase 02.
# Changez simplement true/false pour activer/d√©sactiver.
#
# ATTENTION : Certaines √©tapes ont des d√©pendances (voir matrice ci-dessous)
# =============================================================================

step_02_config:
  # ---------------------------------------------------------------------------
  # MODE DE CONFIGURATION
  # ---------------------------------------------------------------------------
  # Options : "preset", "custom"
  # - "preset" : utilise un preset pr√©d√©fini (voir section presets)
  # - "custom" : configuration manuelle via les flags ci-dessous
  mode: "preset"

  # Preset √† utiliser si mode="preset"
  # Options : "minimal", "balanced", "maximal", "legacy_v1"
  preset: "balanced"

  # ---------------------------------------------------------------------------
  # FLAGS D'ACTIVATION (utilis√©s si mode="custom")
  # ---------------------------------------------------------------------------
  # Cochez true/false pour activer/d√©sactiver chaque sous-√©tape

  # [2.1] Query Understanding & Routing
  step_2_1_routing:
    enabled: true                          # ‚≠ê Recommand√©
    classification: true                   # Classifier type query
    routing_rules: true                    # Router selon type
    retriever_selection: true              # D√©sactiver retrievers inutiles

  # [2.2] Metadata Extraction & Filtering
  step_2_2_metadata:
    enabled: true                          # ‚≠ê Recommand√©
    self_query: true                       # NL ‚Üí filtres structur√©s
    temporal_filtering: true               # Filtres temporels
    geographic_filtering: true             # Filtres g√©ographiques
    domain_filtering: true                 # Filtres domaine
    format_filtering: false                # Filtres format (optionnel)

  # [2.3] Adaptive Retrieval Strategy
  step_2_3_adaptive:
    enabled: true                          # ‚≠ê Recommand√©
    adaptive_top_k: true                   # Adapter top_k selon complexit√©
    technique_selection: true              # S√©lectionner techniques
    latency_budgeting: true                # Budget latence
    early_stopping: false                  # Arr√™t anticip√© (optionnel)

  # [2.4] Dense Retrieval
  step_2_4_dense:
    enabled: true                          # ‚≠ê‚≠ê‚≠ê OBLIGATOIRE
    contextual_embeddings: true            # Embedding metadata (recommand√©)
    multi_index: true                      # Multi-index support
    query_expansion: false                 # Expansion (d√©j√† fait Phase 01)

  # [2.5] Sparse Retrieval
  step_2_5_sparse:
    enabled: true                          # ‚≠ê‚≠ê Important
    adaptive_params: true                  # Param√®tres adaptatifs
    query_expansion: true                  # Expansion (synonymes, acronymes)
    entity_boosting: true                  # Boost entit√©s

  # [2.6] Late Interaction
  step_2_6_late:
    enabled: true                          # ‚≠ê Recommand√© (si budget latence OK)
    compression: true                      # Compression r√©siduelle
    token_pruning: true                    # Token pruning
    quantization_2bit: true                # Quantization 2-bit

  # [2.7] Multi-Index Retrieval
  step_2_7_multi_index:
    enabled: true                          # ‚≠ê Recommand√©
    domain_indexes: true                   # Index par domaine
    language_indexes: true                 # Index par langue
    temporal_indexes: false                # Index temporel (optionnel)

  # [2.8] Cache & Deduplication
  step_2_8_cache:
    enabled: true                          # ‚≠ê‚≠ê‚≠ê OBLIGATOIRE production
    query_similarity: true                 # Cache similaire queries
    result_warming: true                   # Warming top queries
    adaptive_ttl: true                     # TTL adaptatif
    deduplication: true                    # √âliminer doublons

  # [2.9] Results Fusion
  step_2_9_fusion:
    enabled: true                          # ‚≠ê‚≠ê‚≠ê OBLIGATOIRE
    method: "RRF"                          # "RRF", "weighted_sum", "learned"
    confidence_scoring: true               # Score confiance
    multi_source_fusion: true              # Fusion cross-index

  # [2.10] Quality Validation
  step_2_10_validation:
    enabled: true                          # ‚≠ê Recommand√©
    relevance_check: true                  # Score minimum
    diversity_check: true                  # √âviter doublons
    coverage_check: true                   # Couvrir aspects query
    outlier_filtering: true                # √âliminer outliers

  # [2.11] Fallback Strategies
  step_2_11_fallback:
    enabled: false                         # ‚ö†Ô∏è D√©sactiv√© par d√©faut (+500ms)
    relax_filters: true                    # Rel√¢cher filtres
    query_reformulation: false             # Reformuler (LLM, lent)
    web_search: false                      # Web search (tr√®s lent)
    cross_lingual: false                   # Chercher autres langues

  # [2.12] Performance Monitoring
  step_2_12_monitoring:
    enabled: true                          # ‚≠ê‚≠ê‚≠ê OBLIGATOIRE
    latency_breakdown: true                # Breakdown par √©tape
    quality_metrics: true                  # Recall, precision, MRR
    cache_metrics: true                    # Hit rate, etc.
    export_prometheus: false               # Export Prometheus (optionnel)

# =============================================================================
# üì¶ PRESETS DE CONFIGURATION
# =============================================================================
# Configurations pr√©d√©finies pour d√©marrage rapide.
# S√©lectionner via : step_02_config.mode="preset" et step_02_config.preset="..."
# =============================================================================

presets:
  # ---------------------------------------------------------------------------
  # PRESET : minimal (Quick Start)
  # ---------------------------------------------------------------------------
  # Configuration minimale pour d√©marrage rapide.
  # Gains : +20% qualit√©, -30% latence vs v1
  # Effort : 1-2 semaines impl√©mentation
  # Use case : FAQ, Support Client, Latence critique (<100ms)
  # ---------------------------------------------------------------------------
  minimal:
    description: "Configuration minimale - Quick Start"
    latency_target_ms: 80
    quality_gain_estimate: "+20%"

    enabled_steps:
      step_2_1_routing:
        enabled: true
        classification: true              # Heuristic seulement
        routing_rules: true
        retriever_selection: false

      step_2_2_metadata:
        enabled: true
        self_query: false                 # D√©sactiv√© (LLM lent)
        temporal_filtering: true          # Rule-based
        geographic_filtering: false
        domain_filtering: true            # Keyword-based
        format_filtering: false

      step_2_3_adaptive:
        enabled: true
        adaptive_top_k: true              # top_k=20 pour simple queries
        technique_selection: true
        latency_budgeting: true
        early_stopping: true              # Arr√™t si qualit√© suffisante

      step_2_4_dense:
        enabled: true
        contextual_embeddings: false      # D√©sactiv√© (latence)
        multi_index: false
        query_expansion: false

      step_2_5_sparse:
        enabled: true
        adaptive_params: true
        query_expansion: false            # D√©sactiv√© (latence)
        entity_boosting: false

      step_2_6_late:
        enabled: false                    # D√©sactiv√© (trop lent)

      step_2_7_multi_index:
        enabled: false                    # D√©sactiv√© (latence)

      step_2_8_cache:
        enabled: true                     # ‚úÖ CRITIQUE pour latence
        query_similarity: true
        result_warming: true
        adaptive_ttl: true
        deduplication: true

      step_2_9_fusion:
        enabled: true
        method: "RRF"
        confidence_scoring: false
        multi_source_fusion: false

      step_2_10_validation:
        enabled: true
        relevance_check: true
        diversity_check: false            # D√©sactiv√© (latence)
        coverage_check: false
        outlier_filtering: true

      step_2_11_fallback:
        enabled: false                    # D√©sactiv√© (trop lent)

      step_2_12_monitoring:
        enabled: true
        latency_breakdown: true
        quality_metrics: false
        cache_metrics: true
        export_prometheus: false

  # ---------------------------------------------------------------------------
  # PRESET : balanced (Recommand√©)
  # ---------------------------------------------------------------------------
  # Configuration √©quilibr√©e qualit√©/latence/effort.
  # Gains : +45% qualit√©, latence ~200ms
  # Effort : 3-4 semaines impl√©mentation
  # Use case : Recherche entreprise, Intranet, E-commerce
  # ---------------------------------------------------------------------------
  balanced:
    description: "Configuration √©quilibr√©e - Recommand√© pour production"
    latency_target_ms: 200
    quality_gain_estimate: "+45%"

    enabled_steps:
      step_2_1_routing:
        enabled: true
        classification: true              # ML classifier ou LLM
        routing_rules: true
        retriever_selection: true         # ‚úÖ D√©sactiver retrievers inutiles

      step_2_2_metadata:
        enabled: true
        self_query: true                  # ‚úÖ LLM pour Self-Query
        temporal_filtering: true
        geographic_filtering: true
        domain_filtering: true
        format_filtering: false

      step_2_3_adaptive:
        enabled: true
        adaptive_top_k: true              # top_k=20-200 adaptatif
        technique_selection: true
        latency_budgeting: true
        early_stopping: false

      step_2_4_dense:
        enabled: true
        contextual_embeddings: true       # ‚úÖ Embedding metadata
        multi_index: true                 # ‚úÖ Index sp√©cialis√©s
        query_expansion: false

      step_2_5_sparse:
        enabled: true
        adaptive_params: true
        query_expansion: true             # ‚úÖ Synonymes, acronymes
        entity_boosting: true             # ‚úÖ Boost entit√©s

      step_2_6_late:
        enabled: true                     # ‚úÖ ColBERT activ√©
        compression: true                 # ‚úÖ Compression r√©siduelle
        token_pruning: true
        quantization_2bit: true           # ‚úÖ 2-bit quantization

      step_2_7_multi_index:
        enabled: true                     # ‚úÖ Multi-index
        domain_indexes: true
        language_indexes: true
        temporal_indexes: false

      step_2_8_cache:
        enabled: true
        query_similarity: true
        result_warming: true
        adaptive_ttl: true
        deduplication: true

      step_2_9_fusion:
        enabled: true
        method: "RRF"
        confidence_scoring: true          # ‚úÖ Confidence scoring
        multi_source_fusion: true         # ‚úÖ Fusion cross-index

      step_2_10_validation:
        enabled: true
        relevance_check: true
        diversity_check: true             # ‚úÖ MMR
        coverage_check: true              # ‚úÖ Coverage check
        outlier_filtering: true

      step_2_11_fallback:
        enabled: true                     # ‚úÖ Fallback activ√©
        relax_filters: true               # ‚úÖ Relax filters
        query_reformulation: false        # D√©sactiv√© (trop lent)
        web_search: false
        cross_lingual: false

      step_2_12_monitoring:
        enabled: true
        latency_breakdown: true
        quality_metrics: true             # ‚úÖ Recall, precision, MRR
        cache_metrics: true
        export_prometheus: true           # ‚úÖ Prometheus

  # ---------------------------------------------------------------------------
  # PRESET : maximal (SOTA)
  # ---------------------------------------------------------------------------
  # Configuration maximale pour qualit√© optimale.
  # Gains : +60% qualit√©, latence ~320ms
  # Effort : 2-3 mois impl√©mentation
  # Use case : Recherche acad√©mique, Legal, Medical, Qualit√© primordiale
  # ---------------------------------------------------------------------------
  maximal:
    description: "Configuration maximale - SOTA"
    latency_target_ms: 320
    quality_gain_estimate: "+60%"

    enabled_steps:
      step_2_1_routing:
        enabled: true
        classification: true              # LLM classifier
        routing_rules: true
        retriever_selection: true

      step_2_2_metadata:
        enabled: true
        self_query: true                  # LLM + NER
        temporal_filtering: true
        geographic_filtering: true
        domain_filtering: true
        format_filtering: true            # ‚úÖ Activ√©

      step_2_3_adaptive:
        enabled: true
        adaptive_top_k: true              # top_k=200 pour complexe
        technique_selection: true
        latency_budgeting: true
        early_stopping: false

      step_2_4_dense:
        enabled: true
        contextual_embeddings: true       # + fine-tuned
        multi_index: true
        query_expansion: false

      step_2_5_sparse:
        enabled: true
        adaptive_params: true
        query_expansion: true             # Expansion agressive
        entity_boosting: true

      step_2_6_late:
        enabled: true
        compression: true
        token_pruning: true
        quantization_2bit: true           # ou 1-bit si m√©moire critique

      step_2_7_multi_index:
        enabled: true
        domain_indexes: true
        language_indexes: true
        temporal_indexes: true            # ‚úÖ Index temporel

      step_2_8_cache:
        enabled: true
        query_similarity: true
        result_warming: true
        adaptive_ttl: true
        deduplication: true

      step_2_9_fusion:
        enabled: true
        method: "learned"                 # ‚úÖ Learned fusion
        confidence_scoring: true
        multi_source_fusion: true

      step_2_10_validation:
        enabled: true
        relevance_check: true             # Threshold strict
        diversity_check: true
        coverage_check: true              # Coverage strict
        outlier_filtering: true

      step_2_11_fallback:
        enabled: true                     # ‚úÖ Toutes strat√©gies
        relax_filters: true
        query_reformulation: true         # ‚úÖ LLM reformulation
        web_search: true                  # ‚úÖ Web search
        cross_lingual: true               # ‚úÖ Cross-lingual

      step_2_12_monitoring:
        enabled: true
        latency_breakdown: true
        quality_metrics: true
        cache_metrics: true
        export_prometheus: true

  # ---------------------------------------------------------------------------
  # PRESET : legacy_v1 (Backward Compatible)
  # ---------------------------------------------------------------------------
  # Configuration identique √† la v1 pour compatibilit√©.
  # Gains : Baseline (0%)
  # Use case : Migration progressive, A/B testing
  # ---------------------------------------------------------------------------
  legacy_v1:
    description: "Configuration v1 - Backward compatible"
    latency_target_ms: 225
    quality_gain_estimate: "Baseline (0%)"

    enabled_steps:
      step_2_1_routing:
        enabled: false                    # ‚ùå N'existe pas en v1

      step_2_2_metadata:
        enabled: false                    # ‚ùå N'existe pas en v1

      step_2_3_adaptive:
        enabled: false                    # ‚ùå N'existe pas en v1

      step_2_4_dense:
        enabled: true                     # ‚úÖ BGE-M3 (comme v1)
        contextual_embeddings: false
        multi_index: false
        query_expansion: false

      step_2_5_sparse:
        enabled: true                     # ‚úÖ BM25 (comme v1)
        adaptive_params: false
        query_expansion: false
        entity_boosting: false

      step_2_6_late:
        enabled: true                     # ‚úÖ ColBERT (comme v1)
        compression: false                # Pas de compression v1
        token_pruning: false
        quantization_2bit: false

      step_2_7_multi_index:
        enabled: false                    # ‚ùå N'existe pas en v1

      step_2_8_cache:
        enabled: false                    # ‚ùå N'existe pas en v1
        query_similarity: false
        result_warming: false
        adaptive_ttl: false
        deduplication: true               # ‚úÖ Dedup existe en v1

      step_2_9_fusion:
        enabled: true                     # ‚úÖ RRF (comme v1)
        method: "RRF"
        confidence_scoring: false
        multi_source_fusion: false

      step_2_10_validation:
        enabled: false                    # ‚ùå N'existe pas en v1

      step_2_11_fallback:
        enabled: false                    # ‚ùå N'existe pas en v1

      step_2_12_monitoring:
        enabled: false                    # ‚ùå N'existe pas en v1

# =============================================================================
# üìä MATRICE DE D√âPENDANCES
# =============================================================================
# Certaines √©tapes d√©pendent d'autres. Cette section documente les d√©pendances.
# Le syst√®me validera automatiquement la configuration au d√©marrage.
# =============================================================================

dependencies:
  # Si vous activez une √©tape avec d√©pendances, les d√©pendances doivent √™tre activ√©es aussi

  step_2_1_routing:
    requires:
      - step_2_4_dense                          # Besoin dense pour routing
    optional:
      - step_2_5_sparse                         # Am√©liore routing
      - step_2_6_late                           # Am√©liore routing

  step_2_2_metadata:
    optional:
      - "Phase 01: step_1_1_query_understanding"  # Am√©liore metadata extraction
      - "Phase 01: step_1_5_metadata"             # R√©utilise metadata Phase 01

  step_2_3_adaptive:
    requires:
      - "Phase 01: step_1_1_query_understanding.complexity_scoring"  # Besoin complexity score
    optional:
      - step_2_1_routing                        # Am√©liore adaptive strategy

  step_2_7_multi_index:
    requires:
      - step_2_4_dense                          # Besoin dense pour multi-index
    optional:
      - step_2_2_metadata                       # Metadata pour s√©lection index
      - step_2_5_sparse                         # Sparse sur multi-index
      - step_2_6_late                           # Late sur multi-index

  step_2_9_fusion:
    requires:
      - step_2_4_dense                          # Au moins 1 retriever
    warning: "Au moins 2 retrievers recommand√©s pour fusion"

  step_2_10_validation:
    requires:
      - step_2_9_fusion                         # Valide r√©sultats fusionn√©s

  step_2_11_fallback:
    requires:
      - step_2_10_validation                    # Trigger si validation fail

  step_2_6_late.compression:
    warning: "Compression r√©siduelle n√©cessite retraining ColBERT"

  step_2_9_fusion.method_learned:
    requires:
      - "Donn√©es labellis√©es pour training"
    warning: "Learned fusion n√©cessite 10K+ queries labellis√©es"

# =============================================================================
# üîç VALIDATION DE CONFIGURATION
# =============================================================================
# Validation automatique au d√©marrage pour d√©tecter configurations invalides.
# =============================================================================

validation:
  enabled: true                                  # Valider config au d√©marrage

  # Comportement si d√©pendances manquantes
  # Options : "error" (bloquer), "warn" (avertir), "auto_fix" (corriger auto)
  on_missing_dependency: "warn"

  # Comportement si configuration incoh√©rente
  on_invalid_config: "error"

  # Checks √† effectuer
  checks:
    - "check_dependencies"                       # V√©rifier d√©pendances
    - "check_model_availability"                 # V√©rifier mod√®les t√©l√©charg√©s
    - "check_index_availability"                 # V√©rifier index cr√©√©s
    - "check_cache_backend"                      # V√©rifier Redis accessible
    - "check_latency_budget"                     # V√©rifier budget latence r√©aliste

# =============================================================================
# üêõ MODE DEBUG
# =============================================================================
# Logging d√©taill√© de chaque sous-√©tape pour debugging.
# =============================================================================

debug:
  enabled: false                                 # D√©sactiver en production

  # Niveau de logging
  # Options : "DEBUG", "INFO", "WARNING", "ERROR"
  log_level: "DEBUG"

  # Logger chaque sous-√©tape individuellement
  log_substeps: true

  # Inclure donn√©es interm√©diaires dans les logs
  include_intermediate_data: true

  # Inclure r√©sultats interm√©diaires (top-10 par retriever)
  include_intermediate_results: true

  # Dur√©e max acceptable par sous-√©tape (alertes si d√©pass√©)
  latency_alerts:
    step_2_1: 15                                 # ms
    step_2_2: 30
    step_2_3: 10
    step_2_4: 120                                # Dense peut √™tre lent
    step_2_5: 60
    step_2_6: 120                                # Late peut √™tre lent
    step_2_7: 10
    step_2_8: 5                                  # Cache doit √™tre rapide
    step_2_9: 25
    step_2_10: 15
    step_2_11: 600                               # Fallback peut √™tre tr√®s lent
    step_2_12: 10

# =============================================================================
# üíæ CONFIGURATION D√âTAILL√âE DES SOUS-√âTAPES
# =============================================================================
# Configuration fine de chaque sous-√©tape (identique √† 02_retrieval_v2.yaml)
# Ces param√®tres sont utilis√©s si l'√©tape est activ√©e via master config
# =============================================================================

# Importer configuration d√©taill√©e depuis 02_retrieval_v2.yaml
# (dans impl√©mentation r√©elle, fusionner les 2 configs)

# [2.1] Query Understanding & Routing
query_routing:
  classification:
    classifier: "heuristic"
    heuristic:
      rules:
        factual:
          patterns: ["^(qui|quoi|quel|quelle|quand|o√π|combien)"]
        analytical:
          patterns: ["^(pourquoi|comment|why|how)"]

  routing_rules:
    factual:
      dense_weight: 0.3
      sparse_weight: 0.5
      late_weight: 0.2
    analytical:
      dense_weight: 0.5
      sparse_weight: 0.2
      late_weight: 0.3

# [2.2] Metadata Extraction & Filtering
metadata_filtering:
  self_query:
    parser: "llm"
    llm:
      provider: "ollama"
      model: "llama3"

  temporal_filtering:
    extractor: "dateparser"
    languages: ["fr", "en"]

  geographic_filtering:
    extractor: "ner"
    model: "fr_core_news_md"

  domain_filtering:
    classifier:
      method: "keyword"
      domains: ["finance", "technology", "healthcare", "legal"]

# [2.3] Adaptive Retrieval Strategy
adaptive_retrieval:
  top_k_strategy:
    auto: true
    complexity_mapping:
      simple: 20
      medium: 100
      complex: 200

  latency_budget:
    total_ms: 300
    allocation:
      routing: 10
      metadata: 25
      dense: 100
      sparse: 50
      late: 100

# [2.4] Dense Retrieval
dense_retrieval:
  model:
    provider: "sentence_transformers"
    model_name: "BAAI/bge-m3"
    embedding_dim: 1024

  contextual_embeddings:
    metadata_fields: ["title", "domain", "date"]

  multi_index:
    indexes:
      - name: "main"
      - name: "finance"
      - name: "tech"

  quantization:
    method: "binary"

# [2.5] Sparse Retrieval
sparse_retrieval:
  tool:
    name: "pyserini"
  algorithm: "bm25"
  params:
    k1: 1.5
    b: 0.75

  query_expansion:
    sources: ["synonyms", "acronyms"]

  entity_boosting:
    boost_factors:
      PERSON: 1.5
      ORG: 1.3

# [2.6] Late Interaction
late_interaction:
  model:
    name: "colbert-ir/colbertv2.0"
    token_embedding_dim: 128

  compression:
    method: "residual"
    quantization_bits: 2

  token_pruning:
    pruning_threshold: 0.1

# [2.8] Cache & Deduplication
caching:
  backend:
    type: "redis"
    redis:
      host: "localhost"
      port: 6379

  query_similarity:
    threshold: 0.95
    method: "embedding"

  warming:
    top_queries: 1000
    refresh_interval: "1h"

  ttl:
    adaptive: true
    default: 3600
    by_domain:
      finance: 1800
      legal: 7200

deduplication:
  similarity_threshold: 0.95
  method: "cosine"
  near_duplicate_detection: true

# [2.9] Results Fusion
fusion:
  method: "RRF"
  global_top_k: 100

  rrf:
    k: 60

  learned_fusion:
    enabled: false
    model: "xgboost"

  confidence_scoring:
    method: "aggregation"

# [2.10] Quality Validation
quality_validation:
  relevance_check:
    min_score: 0.5
    action: "filter"

  diversity_check:
    method: "mmr"
    mmr:
      lambda: 0.6

  coverage_check:
    query_aspects: ["entities", "keywords", "topics"]
    min_coverage: 0.7

# [2.11] Fallback Strategies
fallback:
  triggers:
    min_results: 5
    min_avg_score: 0.6

  strategies:
    - type: "relax_filters"
      order: 1
      relax_sequence: ["format_filter", "temporal_filter", "domain_filter"]

    - type: "query_reformulation"
      order: 2
      llm:
        provider: "ollama"
        model: "llama3"

    - type: "web_search"
      order: 3
      provider: "duckduckgo"

# [2.12] Performance Monitoring
monitoring:
  latency:
    breakdown_by_step: true
    alert_threshold_ms: 500

  quality:
    metrics: ["recall@10", "recall@100", "precision@5", "MRR", "nDCG@10"]

  cache:
    metrics: ["hit_rate", "miss_rate", "eviction_rate"]

  export:
    format: "prometheus"
    prometheus:
      endpoint: "http://prometheus:9090"

# =============================================================================
# üìù NOTES D'UTILISATION
# =============================================================================
#
# D√âMARRAGE RAPIDE :
#
# 1. Mode Preset (Recommand√©) :
#    - Changez : step_02_config.mode = "preset"
#    - S√©lectionnez : step_02_config.preset = "minimal" | "balanced" | "maximal"
#    - C'est tout ! Le preset active automatiquement les bonnes √©tapes
#
# 2. Mode Custom (Contr√¥le total) :
#    - Changez : step_02_config.mode = "custom"
#    - Activez/d√©sactivez : step_02_config.step_2_X.enabled = true/false
#    - Configurez finement chaque sous-√©tape
#
# EXEMPLES :
#
# # Exemple 1 : Quick Start (minimal)
# step_02_config:
#   mode: "preset"
#   preset: "minimal"
#
# # Exemple 2 : Production (balanced)
# step_02_config:
#   mode: "preset"
#   preset: "balanced"
#
# # Exemple 3 : Custom (activer seulement Dense + Sparse + Cache)
# step_02_config:
#   mode: "custom"
#   step_2_1_routing: {enabled: false}
#   step_2_2_metadata: {enabled: false}
#   step_2_3_adaptive: {enabled: false}
#   step_2_4_dense: {enabled: true, contextual_embeddings: true}
#   step_2_5_sparse: {enabled: true, query_expansion: true}
#   step_2_6_late: {enabled: false}
#   step_2_7_multi_index: {enabled: false}
#   step_2_8_cache: {enabled: true}
#   step_2_9_fusion: {enabled: true, method: "RRF"}
#   step_2_10_validation: {enabled: true}
#   step_2_11_fallback: {enabled: false}
#   step_2_12_monitoring: {enabled: true}
#
# VALIDATION :
# Le syst√®me valide automatiquement les d√©pendances au d√©marrage.
# Si une √©tape n√©cessite une d√©pendance d√©sactiv√©e, vous recevrez un warning.
#
# OPTIMISATION PAR USE CASE :
#
# - FAQ/Support Client : preset="minimal" + cache agressif
# - Recherche Entreprise : preset="balanced" (recommand√©)
# - Recherche Acad√©mique : preset="maximal" + fallback complet
# - E-commerce : preset="minimal" + metadata filtering agressif
#
# =============================================================================
